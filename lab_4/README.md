## <center> Spark K-Means
<center>夏鑫 计研162 2016210981</center>

### 主要内容
#### [Kmeans 数据处理](#pro_data)
#### [性能测试](#expe)

### <a name="pro_data"></a>Kmeans 数据处理

使用的数据集为 `KDD Cup 99`, 每一条数据如下

```
0,tcp,http,SF,341,1473,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,7,7,0.00,0.00,0.00,0.00,1.00,0.00,0.00,24,255,1.00,0.00,0.04,0.03,0.00,0.00,0.00,0.00,normal.
```

由于每一条数据的特征既包括数值数据，又包括类别数据。因此最朴素的 `K-means` 无法满足要求。这里参考`k-prototypes`:

- 对于数值数据，使用欧式距离
- 对于类别数据，使用海明威距离

这样定义之后，两个特征之间的距离有如下公式

$$
d(\vec{x_i}, \vec{x_m}) = \Sigma_{j = 1}^p (x_{ij} - x_{mj})^2 + u\Sigma_{j = p + 1}^n \delta(x_{ij}, x_{mj})
$$

其中 $u$ 为权重

$$
\sigma(a, b) = 
\begin{cases}
1, a == b \\
0, a \neq b
\end{cases}
$$


### <a name="expe"></a>Kmeans 性能测试

###### kddcup.data_10_percent 机器数

| 机器数 | 核数/机器 | 时间(ms) |  轮次 |
| :--------: | :--------: | :---: | :---:|
| 1 | 1 | 127689 | 10 |
| 1 | 2 | 78800 | 10 |
| 1 | 4 | 82282 | 9 |
| 2 | 1 | 78518 | 10 |
| 2 | 2 | 69970 | 8 |
| 2 | 4 | 92863 | 11 |
| 4 | 1 | 75538 | 10 | 
| 4 | 2 | 74724 | 9 |
| 4 | 4 | 87638 | 10 |



###### kddcup.data 机器数

| 机器数 | 核数/机器 | 时间(ms) |  轮次 |
| :--------: | :--------: | :---: | :---: |
| 1 | 1 | 3335722 | 19 |
| 1 | 2 | 1571783 | 19 |
| 1 | 4 | 1044637 | 17 |
| 2 | 1 | 1578697 | 19 |
| 2 | 2 | 911907 | 17 |
| 2 | 4 | 691669 | 19 |
| 4 | 1 | 864762 | 17 | 
| 4 | 2 | 582333 | 19 |
| 4 | 4 | 427227 | 12 |

观察数据，可以得到：

- 当机器数以及核数非常少时，增加机器数以及核数对性能的提升近似线性，分析原因在于此时性能的主要瓶颈是计算，因此增加计算能力，可以有效增加性能
- 当机器数以及核数到达一定的数量时，再增加机器数或者核数，对性能的提升不是特别明显，因为此时通讯的开销变得很大，计算不再是主要的瓶颈